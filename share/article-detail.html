<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article - Abu Media Group</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article - Abu Media Group</title>
    
    <!-- ==================== -->
    <!-- BALISES META OPEN GRAPH (AJOUTEZ CES LIGNES) -->
    <!-- ==================== -->
    <meta property="og:title" id="ogTitle" content="CAMER FLASH INFOS - Actualit√©s du Cameroun">
    <meta property="og:description" id="ogDescription" content="D√©couvrez les derni√®res actualit√©s du Cameroun">
    <meta property="og:image" id="ogImage" content="https://latribunebilingue.com/img/favicon-96x96.png">
    <meta property="og:url" id="ogUrl" content="">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="CFI 237">
    <meta property="og:locale" content="fr_FR">
    
    <!-- Pour Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitterTitle" content="CAMER FLASH INFOS - Actualit√©s du Cameroun">
    <meta name="twitter:description" id="twitterDescription" content="D√©couvrez les derni√®res actualit√©s du Cameroun">
    <meta name="twitter:image" id="twitterImage" content="https://latribunebilingue.com/img/favicon-96x96.png">
    <meta name="twitter:site" content="@CFI237">
    
    <!-- Balises standards -->
    <meta name="description" id="metaDescription" content="D√©couvrez les derni√®res actualit√©s du Cameroun">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   

   
   
   
   <style>
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-solid: #667eea;
            --secondary: #ff6b6b;
            --accent: #ffd93d;
            --dark: #1a1a2e;
            --muted: #94a3b8;
            --glass: rgba(255,255,255,0.95);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --shadow: 0 8px 30px rgba(0,0,0,0.12);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(to bottom, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
            line-height: 1.8;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header */
        header {
            background: var(--glass);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        
        .top-bar {
            background: var(--primary);
            font-size: 0.875rem;
            color: #fff;
        }
        
        .top-bar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
        }
        
        .logo .logo-icon {
            font-size: 36px;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Breadcrumb */
        .breadcrumb {
            padding: 20px 0;
            font-size: 0.9rem;
            color: var(--muted);
        }
        
        .breadcrumb a {
            color: var(--primary-solid);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* Article Layout */
        .article-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
            margin: 40px 0;
        }

        /* Article Main */
        .article-main {
            background: #fff;
            border-radius: 20px;
            padding: 48px;
            box-shadow: var(--shadow);
        }

        .article-header {
            margin-bottom: 32px;
        }

        .article-category-badge {
            display: inline-block;
            background: var(--secondary);
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .article-title {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .article-meta {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            align-items: center;
            padding: 20px 0;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.95rem;
            color: var(--muted);
        }

        .article-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .article-meta-item i {
            color: var(--primary-solid);
        }

        .article-featured-image {
            width: 100%;
            height: 500px;
            border-radius: 16px;
            overflow: hidden;
            margin: 32px 0;
            box-shadow: var(--shadow-lg);
        }

        .article-featured-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .article-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #334155;
        }

        .article-content p {
            margin-bottom: 20px;
        }

        .article-content h2 {
            font-size: 1.8rem;
            margin: 32px 0 16px;
            color: var(--dark);
        }

        .article-content h3 {
            font-size: 1.4rem;
            margin: 24px 0 12px;
            color: var(--dark);
        }

        .article-actions {
            display: flex;
            gap: 16px;
            margin-top: 40px;
            padding-top: 40px;
            border-top: 2px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 150px;
            padding: 14px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-like {
            background: var(--secondary);
            color: #fff;
        }

        .btn-like.liked {
            background: #e74c3c;
            transform: scale(1.05);
        }

        .btn-share {
            background: var(--primary);
            color: #fff;
        }

        .btn-print {
            background: #2c3e50;
            color: #fff;
        }

        .btn-comment {
            background: #3498db;
            color: #fff;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        /* Print Styles */
        @media print {
            header, .breadcrumb, .article-actions, .article-sidebar, footer {
                display: none !important;
            }
            
            .article-main {
                box-shadow: none;
                padding: 0;
            }
            
            .article-featured-image {
                page-break-inside: avoid;
            }
        }

        /* Sidebar */
        .article-sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .sidebar-widget {
            background: #fff;
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        .sidebar-widget h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: var(--dark);
        }

        .related-article, .debate-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: var(--transition);
        }

        .related-article:last-child, .debate-item:last-child {
            border-bottom: none;
        }

        .related-article:hover, .debate-item:hover {
            background: #f8fafc;
            padding-left: 8px;
            margin-left: -8px;
            padding-right: 8px;
            margin-right: -8px;
            border-radius: 8px;
        }

        .related-thumb, .debate-thumb {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
        }

        .related-thumb img, .debate-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-solid);
            font-size: 12px;
        }

        .related-info h4, .debate-info h4 {
            font-size: 0.95rem;
            line-height: 1.4;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .related-date, .debate-date {
            font-size: 0.8rem;
            color: var(--muted);
        }

        /* Debates Widget Styling */
        .debates-widget {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 100%);
            color: #fff;
        }

        .debates-widget h3 {
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .debates-widget h3 i {
            color: var(--accent);
        }

        .debate-item {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .debate-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .debate-info h4 {
            color: #fff;
        }

        .debate-date {
            color: #94a3b8;
        }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: 100px 20px;
        }

        .loading-container i {
            font-size: 3rem;
            color: var(--primary-solid);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Error State */
        .error-container {
            text-align: center;
            padding: 100px 20px;
        }

        .error-container i {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        .error-container h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 12px;
        }

        .error-container p {
            color: var(--muted);
            margin-bottom: 24px;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--primary);
            color: #fff;
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-back:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Responsive */
        @media(max-width: 1024px) {
            .article-layout {
                grid-template-columns: 1fr;
            }
            
            .article-main {
                padding: 32px;
            }
            
            .article-title {
                font-size: 2rem;
            }
        }

        @media(max-width: 768px) {
            .article-main {
                padding: 24px;
            }
            
            .article-title {
                font-size: 1.75rem;
            }
            
            .article-featured-image {
                height: 300px;
            }
            
            .article-content {
                font-size: 1rem;
            }
            
            .article-actions {
                flex-direction: column;
            }
        }

        /* Styles pour le bouton like */
        .btn-like.liked {
            background: #e74c3c !important;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-like:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Animation pour le like */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .btn-like.liked i {
            animation: pulse 0.3s ease-in-out;
        }

/* ========================================
   üìå AJOUTER CE CSS DANS article-detail.html
   ======================================== */

/* Badge vid√©o dans le header */
.article-video-badge {
    display: inline-block;
    background: linear-gradient(135deg, #FF0000, #CC0000);
    color: #fff;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 700;
    margin-left: 12px;
    box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
}

.article-video-badge i {
    margin-right: 6px;
}

/* Container pour le player vid√©o int√©gr√© */
.video-embed-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* Ratio 16:9 */
    height: 0;
    margin: 32px 0;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    background: #000;
}

.video-embed-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

/* Fallback si la vid√©o ne peut pas √™tre int√©gr√©e */
.video-fallback {
    text-align: center;
    padding: 80px 40px;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 20px;
    margin: 32px 0;
}

/* Bouton pour regarder sur la plateforme externe */
.video-external-link {
    display: flex;
    justify-content: center;
    margin: 32px 0;
}

.btn-watch-external {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    background: linear-gradient(135deg, #FF0000, #CC0000);
    color: white;
    padding: 16px 32px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 700;
    font-size: 1.05rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 16px rgba(255, 0, 0, 0.3);
}

.btn-watch-external:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(255, 0, 0, 0.4);
}

.btn-watch-external i {
    font-size: 1.3rem;
}

/* Badge Facebook */
.btn-watch-external i.fa-facebook {
    color: #fff;
}

/* Mise en √©vidence de l'extrait */
.article-excerpt-highlight {
    font-size: 1.25rem !important;
    font-weight: 600 !important;
    color: var(--dark) !important;
    line-height: 1.6 !important;
    margin-bottom: 28px !important;
    padding: 24px;
    background: linear-gradient(135deg, rgba(102,126,234,0.05) 0%, rgba(118,75,162,0.05) 100%);
    border-left: 4px solid var(--primary-solid);
    border-radius: 12px;
}

/* Responsive */
@media (max-width: 768px) {
    .video-embed-container {
        border-radius: 12px;
        margin: 24px 0;
    }
    
    .btn-watch-external {
        width: 100%;
        justify-content: center;
        padding: 14px 24px;
        font-size: 1rem;
    }
    
    .article-video-badge {
        display: block;
        margin: 12px 0 0 0;
        text-align: center;
    }
    
    .video-fallback {
        padding: 60px 20px;
    }
}

@media (max-width: 480px) {
    .video-embed-container {
        margin: 20px 0;
    }
    
    .btn-watch-external {
        padding: 12px 20px;
        font-size: 0.95rem;
    }
    
    .article-excerpt-highlight {
        font-size: 1.1rem !important;
        padding: 20px 16px;
    }
}
      
/* Logo du site */
.site-logo {
    width: 50px;
    height: 50px;
    object-fit: contain;
    border-radius: 8px;
    transition: transform 0.3s ease;
}

.site-logo:hover {
    transform: scale(1.1) rotate(5deg);
}

/* Logo icon de secours */
.logo-icon {
    font-size: 36px;
    background: var(--primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: pulse 2s ease-in-out infinite;
}

/* Responsive logo */
@media (max-width: 768px) {
    .site-logo {
        width: 40px;
        height: 40px;
    }
    
    .logo-icon {
        font-size: 28px;
    }
}

@media (max-width: 480px) {
    .site-logo {
        width: 36px;
        height: 36px;
    }
    
    .logo-icon {
        font-size: 24px;
    }
}

/* Styles essentiels pour la galerie */
.facebook-gallery {
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
}

.facebook-gallery:hover {
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

.facebook-gallery img {
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.facebook-gallery img:hover {
    transform: scale(1.02);
    opacity: 0.9;
}

/* Responsive */
@media (max-width: 768px) {
    .facebook-gallery {
        border-radius: 8px;
    }
    
    .facebook-gallery div[style*="grid-template"] {
        height: 300px !important;
    }
}
    </style>
</head>
<body>
    <header>
        <div class="top-bar">
            <div class="container">
                <div id="currentDate">Chargement...</div>
                <div style="display:flex;gap:12px;align-items:center">
                    <a href="#" style="color:#fff"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.youtube.com/@abutv613" style="color:#fff"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
        <div class="logo-section container">
            <div style="display:flex;align-items:center;gap:12px">
    <img src="img/favicon-96x96.png" 
         alt="CFI 237 Logo" 
         class="site-logo"
         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
    <i class="fas fa-newspaper logo-icon" style="display:none"></i>
    <div>
        <h1 style="margin:0;font-size:20px">CFI 237</h1>
        <p style="font-size:12px;margin:0;color:var(--muted)">Actualit√©s du Cameroun</p>
    </div>
</div>
            <a href="index.html" class="btn-back">
                <i class="fas fa-home"></i> Accueil
            </a>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="container">
        <div class="breadcrumb" id="breadcrumb">
            <a href="index.html">Accueil</a> / 
            <a href="articles.html">Articles</a> / 
            <span id="breadcrumbCategory">Chargement...</span>
        </div>
    </div>

    <!-- Article Content -->
    <div class="container">
        <div id="articleContainer">
            <div class="loading-container">
                <i class="fas fa-spinner fa-spin"></i>
                <p style="color: var(--muted); font-size: 1.1rem;">Chargement de l'article...</p>
            </div>
        </div>
    </div>

  <script>
    const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyzLICM5pJGLJ6msC6A2R0eR8TAeRP-jU2RkTG7C_CDnIjtIJHnGgJHFx0bbzI6Ua4_gw/exec';

    // ===== VARIABLES GLOBALES =====
    let currentArticleId = null;
    let viewsTracked = false;
    let userHasLiked = false;
    let allComments = [];
    let commentsLoaded = false;

    // ===== FONCTION UNIQUE POUR OUVRIR LES ARTICLES ===
    function ouvrirArticle(articleId) {
        console.log('üö® OUVERTURE ARTICLE:', articleId);
        
        // VALIDATION
        if (!articleId || articleId === 'undefined' || articleId === 'null') {
            console.error('‚ùå ID ARTICLE INVALIDE');
            return;
        }
        
        // NETTOYAGE COMPLET
        localStorage.removeItem('articleActuel');
        
        // SAUVEGARDE
        localStorage.setItem('articleActuel', articleId);
        
        // V√âRIFICATION
        const savedId = localStorage.getItem('articleActuel');
        console.log('üíæ ID SAUVEGARD√â:', savedId);
        
        // REDIRECTION VERS LA PAGE D√âTAIL
        window.location.href = 'article-detail.html';
    }
// ========================================
// üéØ MISE √Ä JOUR DES BALISES META DYNAMIQUES
// ========================================

function updateMetaTags(article) {
    console.log('üîÑ Mise √† jour des meta tags pour:', article.titre);
    
    // Pr√©parer les donn√©es
    const title = article.titre || 'Abu Media Group - Actualit√©s du Cameroun';
    const description = article.extrait || 'D√©couvrez les derni√®res actualit√©s du Cameroun';
    const image = article.image || 'https://latribunebilingue.com/img/favicon-96x96.png';
    const currentUrl = window.location.href;
    
    // Mettre √† jour les balises Open Graph
    document.getElementById('ogTitle').setAttribute('content', title);
    document.getElementById('ogDescription').setAttribute('content', description);
    document.getElementById('ogImage').setAttribute('content', image);
    document.getElementById('ogUrl').setAttribute('content', currentUrl);
    
    // Mettre √† jour les balises Twitter
    document.getElementById('twitterTitle').setAttribute('content', title);
    document.getElementById('twitterDescription').setAttribute('content', description);
    document.getElementById('twitterImage').setAttribute('content', image);
    
    // Mettre √† jour la meta description standard
    document.getElementById('metaDescription').setAttribute('content', description);
    
    console.log('‚úÖ Meta tags mis √† jour:', {
        title: title,
        description: description.substring(0, 100) + '...',
        image: image
    });
}
    // ===== FONCTION 1 : Incr√©menter les vues =====
    async function trackArticleView(articleId) {
        if (viewsTracked) return;
        
        try {
            await fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'increment_views',
                    id: articleId
                })
            });
            
            viewsTracked = true;
            console.log('‚úÖ Vue comptabilis√©e pour:', articleId);
        } catch (error) {
            console.error('‚ùå Erreur incr√©mentation vues:', error);
        }
    }

    // ===== FONCTION 2 : Incr√©menter les likes =====
    async function incrementLikes(articleId) {
        try {
            const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'increment_likes',
                    id: articleId
                })
            });
            
            console.log('‚úÖ Like ajout√© pour:', articleId);
            return true;
        } catch (error) {
            console.error('‚ùå Erreur incr√©mentation likes:', error);
            return false;
        }
    }

    // ===== FONCTION 3 : V√©rifier si l'utilisateur a d√©j√† lik√© =====
    function hasUserLiked(articleId) {
        return localStorage.getItem(`liked_${articleId}`) === 'true';
    }

    // ===== FONCTION 4 : Marquer un article comme lik√© =====
    function markArticleAsLiked(articleId) {
        localStorage.setItem(`liked_${articleId}`, 'true');
    }

    // ===== FONCTION 5 : Initialiser l'√©tat du bouton Like =====
    function initializeLikeButton(articleId, currentLikes) {
        const likeBtn = document.getElementById('likeBtn');
        
        if (hasUserLiked(articleId)) {
            likeBtn.classList.add('liked');
            document.getElementById('likeText').textContent = 'J\'aime ‚úì';
        } else {
            likeBtn.classList.remove('liked');
            document.getElementById('likeText').textContent = 'J\'aime';
        }
        
        document.getElementById('likeCount').textContent = currentLikes;
    }

    // ===== FONCTION 6 : Toggle Like =====
    async function toggleLike() {
        const articleId = localStorage.getItem('articleActuel');
        if (!articleId) {
            console.error('‚ùå Aucun article s√©lectionn√©');
            return;
        }
        
        // V√©rifier si d√©j√† lik√©
        if (hasUserLiked(articleId)) {
            alert('Vous avez d√©j√† lik√© cet article !');
            return;
        }
        
        const likeBtn = document.getElementById('likeBtn');
        const likeCount = document.getElementById('likeCount');
        const likeText = document.getElementById('likeText');
        
        // D√©sactiver le bouton pendant l'op√©ration
        likeBtn.disabled = true;
        
        // Incr√©menter les likes
        const success = await incrementLikes(articleId);
        
        if (success) {
            // Mettre √† jour l'interface
            const currentLikes = parseInt(likeCount.textContent);
            likeCount.textContent = currentLikes + 1;
            likeText.textContent = 'J\'aime ‚úì';
            likeBtn.classList.add('liked');
            
            // Marquer comme lik√© dans localStorage
            markArticleAsLiked(articleId);
            
            console.log('‚úÖ Like enregistr√© avec succ√®s');
        } else {
            alert('Erreur lors de l\'ajout du like');
        }
        
        // R√©activer le bouton
        likeBtn.disabled = false;
    }

    // Mettre √† jour la date
    function updateCurrentDate() {
        const days = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
        const months = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
        const now = new Date();
        const dateStr = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
        document.getElementById('currentDate').textContent = dateStr;
    }

    // Formater la date
    function formaterDate(dateString) {
        if (!dateString) return 'Date inconnue';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            
            return date.toLocaleDateString('fr-FR', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        } catch (error) {
            return dateString;
        }
    }

    // V√©rifier si un article est dans une section
    function articleInSection(article, sectionName) {
        if (!article.section) return false;
        const sections = article.section.split(',').map(s => s.trim().toLowerCase());
        
        const sectionMap = {
            'debates': ['debates', 'd√©bats', 'grands d√©bats']
        };
        
        const keywords = sectionMap[sectionName] || [sectionName];
        return keywords.some(keyword => sections.some(s => s.includes(keyword)));
    }

   // ========================================
// ‚úÖ MODIFICATION DANS article-detail.html
// ========================================
// Remplacer la fonction chargerArticle() existante
// ========================================
// üéØ FONCTION getShareUrl CORRECTE
// ========================================
async function getShareUrl(articleId) {
    try {
        console.log('üîó R√©cup√©ration URL share pour:', articleId);
        
        const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=get_share_url&article_id=${articleId}`);
        const result = await response.json();
        
        console.log('üì¶ R√©ponse share URL:', result);
        
        if (result.success && result.shareUrl) {
            // üéØ DOIT √äTRE UN LIEN VERS /share/...html
            return result.shareUrl;
        } else {
            throw new Error(result.error || 'URL de partage non disponible');
        }
    } catch (error) {
        console.error('‚ùå Erreur getShareUrl:', error);
        
        // Fallback : g√©n√©rer l'URL localement
        const articleTitle = document.querySelector('.article-title')?.textContent || 'article';
        const slug = generateSlug(articleTitle) + '-' + articleId;
        const fallbackUrl = `https://cfiupload.netlify.app/share/${slug}.html`;
        
        console.log('üîÑ Utilisation URL fallback:', fallbackUrl);
        return fallbackUrl;
    }
}
async function chargerArticle() {
    try {
        // üéØ R√âCUP√âRER L'ID (peu importe le format)
        const articleId = localStorage.getItem('articleActuel');
        
        console.log('üîç ID r√©cup√©r√©:', articleId, 'Type:', typeof articleId);
        
        if (!articleId || articleId === 'null' || articleId === 'undefined') {
            afficherErreur('Aucun article s√©lectionn√©');
            return;
        }

        // üéØ CHARGER TOUS LES ARTICLES
        const response = await fetch(GOOGLE_APPS_SCRIPT_URL);
        const result = await response.json();
        
        console.log('üì¶ R√©sultat API:', result);
        
        if (!result.success) {
            throw new Error(result.error || 'Erreur de chargement');
        }

        // üéØ INVERSER L'ORDRE (pour correspondre √† index.html)
        const articlesReversed = result.data.reverse();

        // üîç DEBUG: Afficher les IDs disponibles
        console.log('üìã IDs disponibles:', articlesReversed.map(a => ({id: a.id, titre: a.titre})));

        // üéØ RECHERCHE FLEXIBLE DE L'ARTICLE
        let article = null;
        
        // M√©thode 1: Comparaison stricte
        article = articlesReversed.find(a => a.id === articleId);
        
        // M√©thode 2: Comparaison avec conversion en string
        if (!article) {
            article = articlesReversed.find(a => String(a.id) === String(articleId));
        }
        
        // M√©thode 3: Si c'est un nombre, essayer l'index
        if (!article && !isNaN(articleId)) {
            const index = parseInt(articleId) - 1; // -1 car les IDs commencent √† 1
            if (index >= 0 && index < articlesReversed.length) {
                article = articlesReversed[index];
                console.log('üìç Article trouv√© par index:', index);
            }
        }
        
        // M√©thode 4: Recherche avec trim
        if (!article) {
            article = articlesReversed.find(a => 
                String(a.id).trim() === String(articleId).trim()
            );
        }
        
        console.log('üéØ Article trouv√©:', article);
        
        if (!article) {
            console.error('‚ùå Article introuvable');
            console.error('   ID recherch√©:', articleId);
            console.error('   IDs disponibles:', articlesReversed.map(a => a.id));
            afficherErreur('Article non trouv√© (ID: ' + articleId + ')');
            return;
        }

        // ‚úÖ AFFICHER L'ARTICLE
        afficherArticle(article, articlesReversed);

    } catch (error) {
        console.error('‚ùå Erreur:', error);
        afficherErreur('Erreur de chargement de l\'article');
    }
}


// ========================================
// üìä FONCTION DE DEBUG
// ========================================
// Ajouter cette fonction pour d√©bugger
function debugArticleLoading() {
    console.log('=== üîç DEBUG ARTICLE LOADING ===');
    console.log('localStorage.articleActuel:', localStorage.getItem('articleActuel'));
    console.log('Type:', typeof localStorage.getItem('articleActuel'));
    
    // Tester le chargement
    chargerArticle();
}

// ========================================
// üîç LIGHTBOX SIMPLIFI√âE ET FONCTIONNELLE
// (DOIT √äTRE D√âCLAR√âE AVANT afficherArticle)
// ========================================

let currentGalleryImages = [];
let currentImageIndex = 0;

// Fonction pour ouvrir la lightbox
function openImageLightbox(clickedIndex) {
    console.log('üñºÔ∏è Ouverture lightbox, index:', clickedIndex);
    
    // R√©cup√©rer toutes les images de la galerie actuelle
    const galleryContainer = document.querySelector('.facebook-gallery');
    if (!galleryContainer) {
        console.error('‚ùå Galerie non trouv√©e');
        return;
    }
    
    // R√©cup√©rer toutes les images src de la galerie
    const imageElements = galleryContainer.querySelectorAll('img');
    currentGalleryImages = Array.from(imageElements).map(img => img.src);
    currentImageIndex = clickedIndex;
    
    console.log('üì∏ Images trouv√©es:', currentGalleryImages.length, currentGalleryImages);
    
    if (currentGalleryImages.length === 0) {
        console.error('‚ùå Aucune image trouv√©e');
        return;
    }
    
    // Cr√©er la lightbox
    const lightboxHTML = `
        <div id="simpleLightbox" style="
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.95); 
            z-index: 9999; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        ">
            <!-- Bouton fermer -->
            <button onclick="closeSimpleLightbox()" style="
                position: absolute; 
                top: 20px; 
                right: 20px; 
                background: rgba(255,255,255,0.2); 
                border: none; 
                color: white; 
                width: 50px; 
                height: 50px; 
                border-radius: 50%; 
                font-size: 1.3rem; 
                cursor: pointer; 
                z-index: 10000; 
                transition: all 0.3s ease;
            " onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.1)'" 
               onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                <i class="fas fa-times"></i>
            </button>
            
            <!-- Bouton pr√©c√©dent -->
            <button onclick="prevSimpleImage()" style="
                position: absolute; 
                left: 20px; 
                top: 50%; 
                transform: translateY(-50%); 
                background: rgba(255,255,255,0.2); 
                border: none; 
                color: white; 
                width: 50px; 
                height: 50px; 
                border-radius: 50%; 
                font-size: 1.3rem; 
                cursor: pointer; 
                z-index: 10000; 
                transition: all 0.3s ease;
            " onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.1)'" 
               onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <!-- Bouton suivant -->
            <button onclick="nextSimpleImage()" style="
                position: absolute; 
                right: 20px; 
                top: 50%; 
                transform: translateY(-50%); 
                background: rgba(255,255,255,0.2); 
                border: none; 
                color: white; 
                width: 50px; 
                height: 50px; 
                border-radius: 50%; 
                font-size: 1.3rem; 
                cursor: pointer; 
                z-index: 10000; 
                transition: all 0.3s ease;
            " onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.1)'" 
               onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                <i class="fas fa-chevron-right"></i>
            </button>
            
            <!-- Compteur -->
            <div style="
                position: absolute; 
                top: 20px; 
                left: 20px; 
                background: rgba(255,255,255,0.2); 
                color: white; 
                padding: 8px 16px; 
                border-radius: 20px; 
                font-size: 0.9rem; 
                font-weight: 600; 
                backdrop-filter: blur(10px);
            ">
                <span id="simpleLightboxCounter">${currentImageIndex + 1} / ${currentGalleryImages.length}</span>
            </div>
            
            <!-- Image -->
            <div style="position: relative; max-width: 90%; max-height: 90%; display: flex; align-items: center; justify-content: center;">
                <img id="simpleLightboxImage" 
                     src="${currentGalleryImages[currentImageIndex]}" 
                     style="max-width: 100%; max-height: 90vh; object-fit: contain; border-radius: 8px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);"
                     alt="Image ${currentImageIndex + 1}">
            </div>
        </div>
    `;
    
    // Supprimer toute lightbox existante
    const existingLightbox = document.getElementById('simpleLightbox');
    if (existingLightbox) {
        existingLightbox.remove();
    }
    
    document.body.insertAdjacentHTML('beforeend', lightboxHTML);
    document.body.style.overflow = 'hidden';
    
    // Animation d'entr√©e
    setTimeout(() => {
        const lightbox = document.getElementById('simpleLightbox');
        if (lightbox) {
            lightbox.style.opacity = '1';
        }
    }, 10);
    
    console.log('‚úÖ Lightbox ouverte avec succ√®s');
}

function closeSimpleLightbox() {
    const lightbox = document.getElementById('simpleLightbox');
    if (lightbox) {
        lightbox.style.opacity = '0';
        setTimeout(() => {
            lightbox.remove();
        }, 300);
    }
    document.body.style.overflow = 'auto';
}

function prevSimpleImage() {
    if (currentGalleryImages.length === 0) return;
    currentImageIndex = (currentImageIndex - 1 + currentGalleryImages.length) % currentGalleryImages.length;
    updateSimpleLightboxImage();
}

function nextSimpleImage() {
    if (currentGalleryImages.length === 0) return;
    currentImageIndex = (currentImageIndex + 1) % currentGalleryImages.length;
    updateSimpleLightboxImage();
}

function updateSimpleLightboxImage() {
    const imgElement = document.getElementById('simpleLightboxImage');
    const counterElement = document.getElementById('simpleLightboxCounter');
    
    if (imgElement) {
        imgElement.style.opacity = '0.5';
        setTimeout(() => {
            imgElement.src = currentGalleryImages[currentImageIndex];
            imgElement.alt = `Image ${currentImageIndex + 1}`;
            imgElement.style.opacity = '1';
        }, 150);
    }
    
    // Mettre √† jour le compteur
    if (counterElement) {
        counterElement.textContent = `${currentImageIndex + 1} / ${currentGalleryImages.length}`;
    }
}

// Navigation clavier
document.addEventListener('keydown', function(e) {
    const lightbox = document.getElementById('simpleLightbox');
    if (!lightbox) return;
    
    switch(e.key) {
        case 'Escape':
            closeSimpleLightbox();
            break;
        case 'ArrowLeft':
            prevSimpleImage();
            break;
        case 'ArrowRight':
            nextSimpleImage();
            break;
    }
});

// ========================================
// üñºÔ∏è GALERIE FACEBOOK-LIKE CORRIG√âE
// (DOIT √äTRE D√âCLAR√âE AVANT afficherArticle)
// ========================================

function displayImageGallery(article) {
    console.log('üñºÔ∏è Donn√©es article pour galerie:', article);
    
    // V√©rifier s'il y a des images suppl√©mentaires
    let allImages = [];
    
    try {
        if (article.images && article.images !== '[]' && article.images !== '' && article.images !== 'undefined') {
            console.log('üì¶ Donn√©es images brutes:', article.images);
            
            // Parser le JSON
            allImages = JSON.parse(article.images);
            console.log('üñºÔ∏è Toutes les images:', allImages);
            
            // Retirer la premi√®re image (d√©j√† affich√©e comme couverture)
            if (allImages.length > 1) {
                allImages = allImages.slice(1);
            } else {
                allImages = [];
            }
        }
    } catch (error) {
        console.error('‚ùå Erreur parsing galerie:', error);
        console.error('Donn√©es probl√©matiques:', article.images);
        allImages = [];
    }
    
    console.log('üé® Images pour galerie:', allImages.length, allImages);
    
    if (allImages.length === 0) {
        return ''; // Pas de galerie
    }
    
    return createFacebookStyleGallery(allImages);
}

// Cr√©er une galerie style Facebook
function createFacebookStyleGallery(images) {
    const totalImages = images.length;
    console.log('üìê Cr√©ation galerie avec', totalImages, 'images');
    
    // D√©terminer la disposition en fonction du nombre d'images
    let galleryHTML = '';
    
    if (totalImages === 1) {
        galleryHTML = createSingleImageLayout(images[0], 0, images);
    } else if (totalImages === 2) {
        galleryHTML = createTwoImagesLayout(images);
    } else if (totalImages === 3) {
        galleryHTML = createThreeImagesLayout(images);
    } else if (totalImages === 4) {
        galleryHTML = createFourImagesLayout(images);
    } else {
        galleryHTML = createMultipleImagesLayout(images);
    }
    
    return `
        <div class="article-gallery" style="margin: 40px 0; padding-top: 30px; border-top: 2px solid #e2e8f0;">
            <h3 style="font-size: 1.3rem; font-weight: 700; color: var(--dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-images" style="color: var(--primary-solid);"></i>
                Galerie Photos
                <span style="font-size: 0.9rem; color: var(--muted); font-weight: 500;">(${totalImages})</span>
            </h3>
            
            <div class="facebook-gallery" style="border-radius: 12px; overflow: hidden; background: #f8fafc;">
                ${galleryHTML}
            </div>
        </div>
    `;
}

// Layout pour 1 image
function createSingleImageLayout(image, index, allImages) {
    return `
        <div class="gallery-single" onclick="openImageLightbox(${index})" 
             style="cursor: pointer; transition: opacity 0.3s ease;">
            <img src="${image}" 
                 alt="Image galerie"
                 style="width: 100%; max-height: 500px; object-fit: cover; display: block;"
                 onerror="this.src='https://picsum.photos/800/500?random=${Math.random()}'">
        </div>
    `;
}

// Layout pour 2 images
function createTwoImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px; height: 300px;">
            ${images.map((img, index) => `
                <div onclick="openImageLightbox(${index})" 
                     style="cursor: pointer; overflow: hidden; transition: opacity 0.3s ease;">
                    <img src="${img}" 
                         alt="Image ${index + 1}"
                         style="width: 100%; height: 100%; object-fit: cover;"
                         onerror="this.src='https://picsum.photos/400/300?random=${Math.random()}'">
                </div>
            `).join('')}
        </div>
    `;
}

// Layout pour 3 images
function createThreeImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px;">
            <div onclick="openImageLightbox(0)" 
                 style="grid-column: 1; grid-row: 1 / span 2; cursor: pointer; overflow: hidden;">
                <img src="${images[0]}" 
                     alt="Image 1"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/400/400?random=${Math.random()}'">
            </div>
            <div onclick="openImageLightbox(1)" 
                 style="grid-column: 2; grid-row: 1; cursor: pointer; overflow: hidden;">
                <img src="${images[1]}" 
                     alt="Image 2"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
            </div>
            <div onclick="openImageLightbox(2)" 
                 style="grid-column: 2; grid-row: 2; cursor: pointer; overflow: hidden;">
                <img src="${images[2]}" 
                     alt="Image 3"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
            </div>
        </div>
    `;
}

// Layout pour 4 images
function createFourImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px;">
            ${images.map((img, index) => `
                <div onclick="openImageLightbox(${index})" 
                     style="cursor: pointer; overflow: hidden; transition: opacity 0.3s ease;">
                    <img src="${img}" 
                         alt="Image ${index + 1}"
                         style="width: 100%; height: 100%; object-fit: cover;"
                         onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
                </div>
            `).join('')}
        </div>
    `;
}

// Layout pour 5+ images (CORRIG√â pour afficher correctement le compteur)
function createMultipleImagesLayout(images) {
    const displayedImages = images.slice(0, 5); // Montrer max 5 images dans la grille
    const remainingCount = images.length - 5;
    
    console.log('üî¢ Images affich√©es:', displayedImages.length, 'Restantes:', remainingCount);
    
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px; position: relative;">
            ${displayedImages.map((img, index) => {
                let gridStyle = '';
                
                // Layout pour 5+ images (2x3 grid)
                if (index === 0) {
                    gridStyle = 'grid-column: 1 / span 2; grid-row: 1 / span 2;';
                } else if (index === 1) {
                    gridStyle = 'grid-column: 3; grid-row: 1;';
                } else if (index === 2) {
                    gridStyle = 'grid-column: 3; grid-row: 2;';
                } else if (index === 3) {
                    gridStyle = 'grid-column: 1; grid-row: 3;';
                } else if (index === 4) {
                    gridStyle = 'grid-column: 2 / span 2; grid-row: 3; position: relative;';
                }
                
                return `
                    <div onclick="openImageLightbox(${index})" 
                         style="${gridStyle} cursor: pointer; overflow: hidden; position: relative; transition: opacity 0.3s ease;">
                        <img src="${img}" 
                             alt="Image ${index + 1}"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onerror="this.src='https://picsum.photos/300/300?random=${Math.random()}'">
                        ${index === 4 && remainingCount > 0 ? `
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem; font-weight: 700; cursor: pointer;">
                                +${remainingCount}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('')}
        </div>
    `;
}


// Appeler automatiquement apr√®s 1 seconde
setTimeout(debugArticleLoading, 1000);

function afficherArticle(article, tousLesArticles) {
    const container = document.getElementById('articleContainer');
    
    // Stocker l'ID de l'article courant
    currentArticleId = article.id;
     // üéØ APPELER LA MISE √Ä JOUR DES META TAGS
    updateMetaTags(article);
    // Mettre √† jour le breadcrumb
    document.getElementById('breadcrumbCategory').textContent = article.categorie || 'G√©n√©ral';
    
    // D√©tecter si c'est une vid√©o
    const isVideo = article.contentType === 'video' && article.video_url;
    
    // G√©n√©rer la galerie
    const galleryHTML = displayImageGallery(article);
    
    container.innerHTML = `
        <div class="article-layout">
            <article class="article-main">
                <div class="article-header">
                    <span class="article-category-badge">${article.categorie || 'G√©n√©ral'}</span>
                    ${isVideo ? '<span class="article-video-badge"><i class="fas fa-play-circle"></i> Vid√©o</span>' : ''}
                    <h1 class="article-title">${article.titre || 'Sans titre'}</h1>
                    
                    <div class="article-meta">
                        <div class="article-meta-item">
                            <i class="fas fa-user"></i>
                            <span>Par ${article.auteur || 'R√©daction'}</span>
                        </div>
                        <div class="article-meta-item">
                            <i class="far fa-calendar"></i>
                            <span>${formaterDate(article.date)}</span>
                        </div>
                        <div class="article-meta-item">
                            <i class="far fa-eye"></i>
                            <span id="viewsDisplay">${article.vue || '0'} vues</span>
                        </div>
                        <div class="article-meta-item">
                            <i class="fas fa-heart"></i>
                            <span id="likesDisplay">${article.likes || '0'} j'aime</span>
                        </div>
                    </div>
                </div>

                ${isVideo ? `
                    <!-- SECTION VID√âO -->
                    ${getEmbedCode(article.video_url)}
                    
                    <!-- Bouton externe optionnel -->
                    <div class="video-external-link">
                        <a href="${article.video_url}" target="_blank" class="btn-watch-external">
                            <i class="${getPlatformIcon(article.video_url)}"></i>
                            Regarder sur ${getPlatformName(article.video_url)}
                        </a>
                    </div>
                ` : `
                    <!-- IMAGE DE COUVERTURE -->
                    ${article.image ? `
                        <div class="article-featured-image">
                            <img src="${article.image}" 
                                 alt="${article.titre}"
                                 onerror="this.src='https://picsum.photos/1200/600?random=${Math.random()}'">
                        </div>
                    ` : ''}
                `}

                <div class="article-content">
                    ${article.extrait ? `<p class="article-excerpt-highlight">${article.extrait}</p>` : ''}
                    ${article.contenu || '<p>Contenu de l\'article non disponible.</p>'}
                    
                    <!-- GALERIE APR√àS LE CONTENU -->
                    ${galleryHTML}
                </div>

                <div class="article-actions">
                    <button class="action-btn btn-like" id="likeBtn" onclick="toggleLike()">
                        <i class="fas fa-heart"></i>
                        <span id="likeText">J'aime</span> (<span id="likeCount">${article.likes || '0'}</span>)
                    </button>
                    <button class="action-btn btn-comment" onclick="openCommentSection()">
                        <i class="fas fa-comment"></i>
                        Commenter
                    </button>
                    <button class="action-btn btn-share" onclick="partager()">
                        <i class="fas fa-share-alt"></i>
                        Partager
                    </button>
                    <button class="action-btn btn-print" onclick="imprimerArticle()">
                        <i class="fas fa-print"></i>
                        Imprimer
                    </button>
                </div>

                ${createCommentsSection(article.id)}
            </article>

            <aside class="article-sidebar">
                <div class="sidebar-widget">
                    <h3>Articles similaires</h3>
                    <div id="relatedArticles">
                        <div style="text-align: center; padding: 20px; color: var(--muted);">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Chargement...</p>
                        </div>
                    </div>
                </div>

                <div class="sidebar-widget debates-widget">
                    <h3><i class="fas fa-comments"></i> Grands D√©bats</h3>
                    <div id="debatesSection">
                        <div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.7);">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Chargement...</p>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    `;

    // Mettre √† jour le titre de la page
    document.title = `${article.titre} - Abu Media Group`;
    
    // Initialiser le bouton Like
    initializeLikeButton(article.id, article.likes || 0);
    
    // Charger les contenus de sidebar
    chargerArticlesSimilaires(article, tousLesArticles);
    chargerDebats(tousLesArticles);
    
    // Compter la vue
    trackArticleView(article.id);
    
    // Charger les commentaires
    loadAndDisplayComments(article.id);
}



    
    // ===== FONCTION : Charger et afficher les commentaires =====
    async function loadAndDisplayComments(articleId) {
        try {
            console.log('üîÑ Chargement des commentaires pour:', articleId);
            
            const commentsUrl = GOOGLE_APPS_SCRIPT_URL + '?action=get_comments&article_id=' + articleId;
            console.log('üì° URL commentaires:', commentsUrl);
            
            const response = await fetch(commentsUrl);
            const result = await response.json();
            
            console.log('üì¶ R√©sultat commentaires COMPLET:', result);
            
            if (!result.success) {
                console.error('‚ùå Erreur API commentaires:', result.error);
                displayComments([]);
                return;
            }

            console.log('‚úÖ Commentaires re√ßus:', result.comments);
            
            // Afficher les commentaires
            displayComments(result.comments || []);
            
            // Mettre √† jour le compteur
            const commentCount = document.getElementById('commentCount');
            if (commentCount) {
                commentCount.textContent = (result.comments || []).length;
                console.log('üî¢ Nombre de commentaires:', (result.comments || []).length);
            }

        } catch (error) {
            console.error('‚ùå Erreur loadAndDisplayComments:', error);
            displayComments([]);
        }
    }

    // Charger les articles similaires
    function chargerArticlesSimilaires(articleActuel, tousLesArticles) {
        const similaires = tousLesArticles
            .filter(a => a.id !== articleActuel.id && a.categorie === articleActuel.categorie)
            .slice(0, 5);

        const container = document.getElementById('relatedArticles');

        if (similaires.length === 0) {
            container.innerHTML = '<p style="color: var(--muted); font-size: 0.9rem;">Aucun article similaire</p>';
            return;
        }

        container.innerHTML = similaires.map(article => `
            <div class="related-article" onclick="ouvrirArticle('${article.id}')">
                <div class="related-thumb">
                    <img src="${article.image || 'https://picsum.photos/80/80?random=' + Math.random()}" 
                         alt="${article.titre}"
                         onerror="this.src='https://picsum.photos/80/80?random=' + Math.random()">
                </div>
                <div class="related-info">
                    <h4>${article.titre}</h4>
                    <div class="related-date">${formaterDate(article.date)}</div>
                </div>
            </div>
        `).join('');
    }

    // Charger les d√©bats
    function chargerDebats(tousLesArticles) {
        const debates = tousLesArticles
            .filter(a => articleInSection(a, 'debates'))
            .slice(0, 4);

        const container = document.getElementById('debatesSection');

        if (debates.length === 0) {
            container.innerHTML = '<p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Aucun d√©bat disponible</p>';
            return;
        }

        container.innerHTML = debates.map(debate => {
            const isVideo = debate.contentType === 'video';
            return `
                <div class="debate-item" onclick="${isVideo ? `ouvrirVideo('${debate.video_url}')` : `ouvrirArticle('${debate.id}')`}">
                    <div class="debate-thumb">
                        <img src="${debate.image || 'https://picsum.photos/80/80?random=' + Math.random()}" 
                             alt="${debate.titre}"
                             onerror="this.src='https://picsum.photos/80/80?random=' + Math.random()">
                        ${isVideo ? '<div class="video-indicator"><i class="fas fa-play"></i></div>' : ''}
                    </div>
                    <div class="debate-info">
                        <h4>${debate.titre}</h4>
                        <div class="debate-date">${formaterDate(debate.date)}</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Ouvrir une vid√©o
    function ouvrirVideo(videoUrl) {
        if (videoUrl) {
            window.open(videoUrl, '_blank');
        }
    }

    // Afficher une erreur
    function afficherErreur(message) {
        const container = document.getElementById('articleContainer');
        container.innerHTML = `
            <div class="error-container">
                <i class="fas fa-exclamation-triangle"></i>
                <h2>Article introuvable</h2>
                <p>${message}</p>
                <a href="articles.html" class="btn-back">
                    <i class="fas fa-arrow-left"></i>
                    Retour aux articles
                </a>
            </div>
        `;
    }

    // Fonction d'impression
    function imprimerArticle() {
        window.print();
    }

    // Fonction de partage am√©lior√©e
    function partager() {
        if (navigator.share) {
            navigator.share({
                title: document.title,
                text: document.querySelector('.article-title').textContent,
                url: window.location.href
            });
        } else {
            // Fallback pour les navigateurs qui ne supportent pas l'API Share
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Lien copi√© dans le presse-papier !');
            }).catch(() => {
                prompt('Copiez ce lien :', url);
            });
        }
    }

    // ===== FONCTIONS COMMENTAIRES =====
    async function submitComment(articleId, authorName, authorEmail, commentText) {
        // Validation
        if (!authorName.trim()) {
            alert('Veuillez entrer votre nom');
            return false;
        }
        if (!authorEmail.trim()) {
            alert('Veuillez entrer votre email');
            return false;
        }
        if (!commentText.trim()) {
            alert('Veuillez √©crire un commentaire');
            return false;
        }
        if (commentText.trim().length < 10) {
            alert('Le commentaire doit contenir au moins 10 caract√®res');
            return false;
        }

        try {
            const commentData = {
                action: 'add_comment',
                article_id: String(articleId),
                author_name: authorName.trim(),
                author_email: authorEmail.trim(),
                comment_text: commentText.trim(),
                date: new Date().toISOString()
            };

            const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(commentData)
            });

            console.log('‚úÖ Commentaire envoy√©');
            
            // Recharger les commentaires apr√®s envoi
            setTimeout(() => {
                loadAndDisplayComments(articleId);
            }, 1000);
            
            return true;

        } catch (error) {
            console.error('‚ùå Erreur submitComment:', error);
            return false;
        }
    }

    function displayComments(comments) {
        const commentsContainer = document.getElementById('commentsContainer');
        
        if (!commentsContainer) {
            console.error('‚ùå Conteneur commentsContainer non trouv√©');
            return;
        }

        console.log('üéØ Affichage de', comments.length, 'commentaires');
        
        if (comments.length === 0) {
            commentsContainer.innerHTML = `
                <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
                    <i class="fas fa-comment-slash" style="font-size: 2rem; margin-bottom: 12px;"></i>
                    <p>Aucun commentaire pour le moment.</p>
                    <p style="font-size: 0.9rem;">Soyez le premier √† commenter !</p>
                </div>
            `;
            return;
        }

        commentsContainer.innerHTML = comments.map((comment, index) => `
            <div class="comment-item" style="
                background: #f8fafc;
                border-left: 4px solid var(--primary-solid);
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 16px;
                transition: var(--transition);
            ">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                    <div>
                        <h4 style="margin: 0 0 4px 0; color: var(--dark); font-weight: 600;">
                            ${comment.author_name || 'Anonyme'}
                        </h4>
                        <div style="font-size: 0.8rem; color: var(--muted);">
                            ${formatRelativeDate(comment.date)}
                        </div>
                    </div>
                    ${comment.approved === false ? `
                        <span style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">
                            En attente
                        </span>
                    ` : ''}
                </div>
                <p style="margin: 0; color: #334155; line-height: 1.6;">
                    ${comment.comment_text || ''}
                </p>
            </div>
        `).join('');
        
        console.log('‚úÖ Commentaires affich√©s avec succ√®s');
    }

    // ===== FONCTION : Cr√©er la section commentaires =====
    function createCommentsSection(articleId) {
        return `
            <div id="commentsSection" style="margin-top: 60px; padding-top: 40px; border-top: 2px solid #e2e8f0;">
                <!-- Titre -->
                <h2 style="font-size: 1.8rem; font-weight: 800; color: var(--dark); margin-bottom: 32px; display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-comments" style="color: var(--primary-solid);"></i>
                    Commentaires
                </h2>

                <!-- Formulaire commentaire -->
                <div id="commentFormContainer" style="background: linear-gradient(135deg, rgba(102,126,234,0.05) 0%, rgba(118,75,162,0.05) 100%); border-radius: 16px; padding: 32px; margin-bottom: 40px; border: 2px solid rgba(102,126,234,0.1);">
                    <h3 style="font-size: 1.2rem; font-weight: 700; color: var(--dark); margin-bottom: 24px;">Laissez un commentaire</h3>
                    
                    <form id="commentForm" onsubmit="handleCommentSubmit(event, '${articleId}')">
                        <!-- Nom -->
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-weight: 600; color: var(--dark); margin-bottom: 8px;">
                                Votre nom <span style="color: var(--secondary);">*</span>
                            </label>
                            <input type="text" id="commentAuthorName" placeholder="Ex: Jean Dupont"
                                style="width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; transition: var(--transition);"
                                onFocus="this.style.borderColor='var(--primary-solid)'"
                                onBlur="this.style.borderColor='#e2e8f0'"
                            />
                        </div>

                        <!-- Email -->
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-weight: 600; color: var(--dark); margin-bottom: 8px;">
                                Votre email <span style="color: var(--secondary);">*</span>
                            </label>
                            <input type="email" id="commentAuthorEmail" placeholder="exemple@email.com"
                                style="width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; transition: var(--transition);"
                                onFocus="this.style.borderColor='var(--primary-solid)'"
                                onBlur="this.style.borderColor='#e2e8f0'"
                            />
                            <div style="font-size: 0.8rem; color: var(--muted); margin-top: 6px;">
                                <i class="fas fa-lock" style="margin-right: 4px;"></i>
                                Votre email ne sera pas publi√©
                            </div>
                        </div>

                        <!-- Texte commentaire -->
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-weight: 600; color: var(--dark); margin-bottom: 8px;">
                                Votre commentaire <span style="color: var(--secondary);">*</span>
                            </label>
                            <textarea id="commentText" placeholder="Partagez votre avis..." 
                                style="width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; min-height: 120px; resize: vertical; transition: var(--transition); font-family: inherit;"
                                onFocus="this.style.borderColor='var(--primary-solid)'"
                                onBlur="this.style.borderColor='#e2e8f0'"
                                onInput="updateCharCount()"
                            ></textarea>
                            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.85rem; color: var(--muted);">
                                <span id="charCount">0/500 caract√®res</span>
                                <span>Minimum 10 caract√®res</span>
                            </div>
                        </div>

                        <!-- Bouton envoyer -->
                        <button type="submit" id="submitCommentBtn" 
                            style="width: 100%; padding: 14px 24px; background: var(--primary); color: #fff; border: none; border-radius: 10px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 8px;"
                            onMouseEnter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(102,126,234,0.4)'"
                            onMouseLeave="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                        >
                            <i class="fas fa-paper-plane"></i>
                            Envoyer le commentaire
                        </button>

                        <!-- Message validation -->
                        <div id="commentMessage" style="margin-top: 16px; padding: 12px 16px; border-radius: 10px; display: none; text-align: center; font-weight: 600;"></div>
                    </form>
                </div>

                <!-- Liste des commentaires -->
                <div>
                    <h3 style="font-size: 1.2rem; font-weight: 700; color: var(--dark); margin-bottom: 24px;">
                        <span id="commentCount">0</span> commentaire(s)
                    </h3>
                    <div id="commentsContainer">
                        <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 12px;"></i>
                            <p>Chargement des commentaires...</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // ===== FONCTION : G√©rer l'envoi du formulaire =====
    async function handleCommentSubmit(event, articleId) {
        event.preventDefault();

        const authorName = document.getElementById('commentAuthorName').value;
        const authorEmail = document.getElementById('commentAuthorEmail').value;
        const commentText = document.getElementById('commentText').value;
        const submitBtn = document.getElementById('submitCommentBtn');
        const messageDiv = document.getElementById('commentMessage');

        // D√©sactiver le bouton
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi en cours...';

        // Envoyer le commentaire
        const success = await submitComment(articleId, authorName, authorEmail, commentText);

        if (success) {
            // Afficher le message de succ√®s
            messageDiv.style.display = 'block';
            messageDiv.style.background = '#dcfce7';
            messageDiv.style.color = '#166534';
            messageDiv.style.border = '2px solid #86efac';
            messageDiv.textContent = '‚úÖ Merci ! Votre commentaire a √©t√© publi√©.';

            // R√©initialiser le formulaire
            document.getElementById('commentForm').reset();
            document.getElementById('charCount').textContent = '0/500 caract√®res';

            // Masquer le message apr√®s 5 secondes
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
            
            // Recharger les commentaires
            setTimeout(() => {
                loadAndDisplayComments(articleId);
            }, 1500);
        }

        // R√©activer le bouton
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Envoyer le commentaire';
    }

    // ===== FONCTION : Mettre √† jour le compteur de caract√®res =====
    function updateCharCount() {
        const textarea = document.getElementById('commentText');
        const charCount = document.getElementById('charCount');
        const maxChars = 500;
        const currentChars = textarea.value.length;
        
        charCount.textContent = `${currentChars}/${maxChars} caract√®res`;
        
        // Limiter √† 500 caract√®res
        if (currentChars > maxChars) {
            textarea.value = textarea.value.substring(0, maxChars);
            charCount.textContent = `${maxChars}/${maxChars} caract√®res`;
        }
        
        // Changer la couleur si on est pr√®s de la limite
        if (currentChars > maxChars * 0.9) {
            charCount.style.color = 'var(--secondary)';
        } else {
            charCount.style.color = 'var(--muted)';
        }
    }

    // ===== FONCTION : Ouvrir la section commentaires =====
    async function openCommentSection() {
        const commentsSection = document.getElementById('commentsSection');
        
        if (commentsSection) {
            // Scroller vers la section
            commentsSection.scrollIntoView({ behavior: 'smooth' });
            
            // Focus sur le champ de nom apr√®s un petit d√©lai
            setTimeout(() => {
                const nameField = document.getElementById('commentAuthorName');
                if (nameField) {
                    nameField.focus();
                }
            }, 500);
        } else {
            console.error('‚ùå Section commentaires non trouv√©e');
            alert('Section commentaires non disponible');
        }
    }

    // ===== FONCTION : Formater la date relative =====
    function formatRelativeDate(dateString) {
        if (!dateString) return 'Date inconnue';
        
        try {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const diffHours = Math.ceil(diffTime / (1000 * 60 * 60));
            const diffMinutes = Math.ceil(diffTime / (1000 * 60));
            
            if (diffMinutes < 1) return '√Ä l\'instant';
            if (diffMinutes < 60) return `Il y a ${diffMinutes} minute${diffMinutes > 1 ? 's' : ''}`;
            if (diffHours < 24) return `Il y a ${diffHours} heure${diffHours > 1 ? 's' : ''}`;
            if (diffDays < 7) return `Il y a ${diffDays} jour${diffDays > 1 ? 's' : ''}`;
            
            return date.toLocaleDateString('fr-FR', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        } catch (error) {
            return 'Date inconnue';
        }
    }

    function getEmbedCode(url) {
        if (!url) return '';
        
        // YouTube
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
            const videoId = extractYouTubeId(url);
            if (videoId) {
                return `
                    <div class="video-embed-container">
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>
                `;
            }
        }
        
        // Facebook
        if (url.includes('facebook.com') || url.includes('fb.watch')) {
            return `
                <div class="video-embed-container">
                    <iframe 
                        src="https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(url)}&show_text=false&appId" 
                        frameborder="0" 
                        allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share" 
                        allowfullscreen>
                    </iframe>
                </div>
            `;
        }
        
        // Fallback : lien direct
        return `
            <div class="video-fallback">
                <i class="fas fa-video" style="font-size: 3rem; color: var(--muted); margin-bottom: 16px;"></i>
                <p>Cette vid√©o ne peut pas √™tre int√©gr√©e</p>
                <a href="${url}" target="_blank" class="btn btn-primary">
                    <i class="fas fa-external-link-alt"></i> Voir la vid√©o
                </a>
            </div>
        `;
    }

    function extractYouTubeId(url) {
        const patterns = [
            /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,
            /youtube\.com\/watch\?v=([^"&?\/\s]{11})/,
            /youtube\.com\/embed\/([^"&?\/\s]{11})/,
            /youtu\.be\/([^"&?\/\s]{11})/
        ];
        
        for (let pattern of patterns) {
            const match = url.match(pattern);
            if (match && match[1]) {
                return match[1];
            }
        }
        return null;
    }

    function getPlatformName(url) {
        if (url.includes('youtube.com') || url.includes('youtu.be')) return 'YouTube';
        if (url.includes('facebook.com')) return 'Facebook';
        return 'la plateforme';
    }

    function getPlatformIcon(url) {
        if (url.includes('youtube.com') || url.includes('youtu.be')) return 'fab fa-youtube';
        if (url.includes('facebook.com')) return 'fab fa-facebook';
        return 'fas fa-external-link-alt';
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
        updateCurrentDate();
        chargerArticle();
    });


// ========================================
// üñºÔ∏è GALERIE FACEBOOK-LIKE CORRIG√âE
// ========================================

// ========================================
// üñºÔ∏è GALERIE FACEBOOK-LIKE CORRIG√âE POUR 7+ IMAGES
// ========================================

// ========================================
// üñºÔ∏è GALERIE CORRIG√âE POUR 7+ IMAGES
// ========================================

function displayImageGallery(article) {
    console.log('üñºÔ∏è Donn√©es article pour galerie:', article);
    
    // V√©rifier s'il y a des images suppl√©mentaires
    let allImages = [];
    
    try {
        if (article.images && article.images !== '[]' && article.images !== '' && article.images !== 'undefined') {
            console.log('üì¶ Donn√©es images brutes:', article.images);
            
            // Parser le JSON
            allImages = JSON.parse(article.images);
            console.log('üñºÔ∏è Toutes les images:', allImages);
            
            // Retirer la premi√®re image (d√©j√† affich√©e comme couverture)
            if (allImages.length > 1) {
                allImages = allImages.slice(1);
            } else {
                allImages = [];
            }
        }
    } catch (error) {
        console.error('‚ùå Erreur parsing galerie:', error);
        console.error('Donn√©es probl√©matiques:', article.images);
        allImages = [];
    }
    
    console.log('üé® Images pour galerie:', allImages.length, allImages);
    
    if (allImages.length === 0) {
        return ''; // Pas de galerie
    }
    
    return createFacebookStyleGallery(allImages);
}

// Cr√©er une galerie style Facebook
function createFacebookStyleGallery(images) {
    const totalImages = images.length;
    console.log('üìê Cr√©ation galerie avec', totalImages, 'images');
    
    // D√©terminer la disposition en fonction du nombre d'images
    let galleryHTML = '';
    
    if (totalImages === 1) {
        galleryHTML = createSingleImageLayout(images[0], 0, images);
    } else if (totalImages === 2) {
        galleryHTML = createTwoImagesLayout(images);
    } else if (totalImages === 3) {
        galleryHTML = createThreeImagesLayout(images);
    } else if (totalImages === 4) {
        galleryHTML = createFourImagesLayout(images);
    } else {
        galleryHTML = createMultipleImagesLayout(images);
    }
    
    return `
        <div class="article-gallery" style="margin: 40px 0; padding-top: 30px; border-top: 2px solid #e2e8f0;">
            <h3 style="font-size: 1.3rem; font-weight: 700; color: var(--dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-images" style="color: var(--primary-solid);"></i>
                Galerie Photos
                <span style="font-size: 0.9rem; color: var(--muted); font-weight: 500;">(${totalImages})</span>
            </h3>
            
            <div class="facebook-gallery" style="border-radius: 12px; overflow: hidden; background: #f8fafc;">
                ${galleryHTML}
            </div>
        </div>
    `;
}

// Layout pour 1 image
function createSingleImageLayout(image, index, allImages) {
    return `
        <div class="gallery-single" onclick="openImageLightbox(${index})" 
             style="cursor: pointer; transition: opacity 0.3s ease;">
            <img src="${image}" 
                 alt="Image galerie"
                 style="width: 100%; max-height: 500px; object-fit: cover; display: block;"
                 onerror="this.src='https://picsum.photos/800/500?random=${Math.random()}'">
        </div>
    `;
}

// Layout pour 2 images
function createTwoImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px; height: 300px;">
            ${images.map((img, index) => `
                <div onclick="openImageLightbox(${index})" 
                     style="cursor: pointer; overflow: hidden; transition: opacity 0.3s ease;">
                    <img src="${img}" 
                         alt="Image ${index + 1}"
                         style="width: 100%; height: 100%; object-fit: cover;"
                         onerror="this.src='https://picsum.photos/400/300?random=${Math.random()}'">
                </div>
            `).join('')}
        </div>
    `;
}

// Layout pour 3 images
function createThreeImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px;">
            <div onclick="openImageLightbox(0)" 
                 style="grid-column: 1; grid-row: 1 / span 2; cursor: pointer; overflow: hidden;">
                <img src="${images[0]}" 
                     alt="Image 1"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/400/400?random=${Math.random()}'">
            </div>
            <div onclick="openImageLightbox(1)" 
                 style="grid-column: 2; grid-row: 1; cursor: pointer; overflow: hidden;">
                <img src="${images[1]}" 
                     alt="Image 2"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
            </div>
            <div onclick="openImageLightbox(2)" 
                 style="grid-column: 2; grid-row: 2; cursor: pointer; overflow: hidden;">
                <img src="${images[2]}" 
                     alt="Image 3"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
            </div>
        </div>
    `;
}

// Layout pour 4 images
function createFourImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px;">
            ${images.map((img, index) => `
                <div onclick="openImageLightbox(${index})" 
                     style="cursor: pointer; overflow: hidden; transition: opacity 0.3s ease;">
                    <img src="${img}" 
                         alt="Image ${index + 1}"
                         style="width: 100%; height: 100%; object-fit: cover;"
                         onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
                </div>
            `).join('')}
        </div>
    `;
}

// Layout pour 5+ images (CORRIG√â pour afficher correctement le compteur)
function createMultipleImagesLayout(images) {
    const displayedImages = images.slice(0, 5); // Montrer max 5 images dans la grille
    const remainingCount = images.length - 5;
    
    console.log('üî¢ Images affich√©es:', displayedImages.length, 'Restantes:', remainingCount);
    
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px; position: relative;">
            ${displayedImages.map((img, index) => {
                let gridStyle = '';
                
                // Layout pour 5+ images (2x3 grid)
                if (index === 0) {
                    gridStyle = 'grid-column: 1 / span 2; grid-row: 1 / span 2;';
                } else if (index === 1) {
                    gridStyle = 'grid-column: 3; grid-row: 1;';
                } else if (index === 2) {
                    gridStyle = 'grid-column: 3; grid-row: 2;';
                } else if (index === 3) {
                    gridStyle = 'grid-column: 1; grid-row: 3;';
                } else if (index === 4) {
                    gridStyle = 'grid-column: 2 / span 2; grid-row: 3; position: relative;';
                }
                
                return `
                    <div onclick="openImageLightbox(${index})" 
                         style="${gridStyle} cursor: pointer; overflow: hidden; position: relative; transition: opacity 0.3s ease;">
                        <img src="${img}" 
                             alt="Image ${index + 1}"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onerror="this.src='https://picsum.photos/300/300?random=${Math.random()}'">
                        ${index === 4 && remainingCount > 0 ? `
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem; font-weight: 700; cursor: pointer;">
                                +${remainingCount}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('')}
        </div>
    `;
}
// ========================================
// üñºÔ∏è GALERIE CORRIG√âE POUR 7+ IMAGES
// ========================================

function displayImageGallery(article) {
    console.log('üñºÔ∏è Donn√©es article pour galerie:', article);
    
    // V√©rifier s'il y a des images suppl√©mentaires
    let allImages = [];
    
    try {
        if (article.images && article.images !== '[]' && article.images !== '' && article.images !== 'undefined') {
            console.log('üì¶ Donn√©es images brutes:', article.images);
            
            // Parser le JSON
            allImages = JSON.parse(article.images);
            console.log('üñºÔ∏è Toutes les images:', allImages);
            
            // Retirer la premi√®re image (d√©j√† affich√©e comme couverture)
            if (allImages.length > 1) {
                allImages = allImages.slice(1);
            } else {
                allImages = [];
            }
        }
    } catch (error) {
        console.error('‚ùå Erreur parsing galerie:', error);
        console.error('Donn√©es probl√©matiques:', article.images);
        allImages = [];
    }
    
    console.log('üé® Images pour galerie:', allImages.length, allImages);
    
    if (allImages.length === 0) {
        return ''; // Pas de galerie
    }
    
    return createFacebookStyleGallery(allImages);
}

// Cr√©er une galerie style Facebook
function createFacebookStyleGallery(images) {
    const totalImages = images.length;
    console.log('üìê Cr√©ation galerie avec', totalImages, 'images');
    
    // D√©terminer la disposition en fonction du nombre d'images
    let galleryHTML = '';
    
    if (totalImages === 1) {
        galleryHTML = createSingleImageLayout(images[0], 0, images);
    } else if (totalImages === 2) {
        galleryHTML = createTwoImagesLayout(images);
    } else if (totalImages === 3) {
        galleryHTML = createThreeImagesLayout(images);
    } else if (totalImages === 4) {
        galleryHTML = createFourImagesLayout(images);
    } else {
        galleryHTML = createMultipleImagesLayout(images);
    }
    
    return `
        <div class="article-gallery" style="margin: 40px 0; padding-top: 30px; border-top: 2px solid #e2e8f0;">
            <h3 style="font-size: 1.3rem; font-weight: 700; color: var(--dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-images" style="color: var(--primary-solid);"></i>
                Galerie Photos
                <span style="font-size: 0.9rem; color: var(--muted); font-weight: 500;">(${totalImages})</span>
            </h3>
            
            <div class="facebook-gallery" style="border-radius: 12px; overflow: hidden; background: #f8fafc;">
                ${galleryHTML}
            </div>
        </div>
    `;
}

// Layout pour 1 image
function createSingleImageLayout(image, index, allImages) {
    return `
        <div class="gallery-single" onclick="openImageLightbox(${index})" 
             style="cursor: pointer; transition: opacity 0.3s ease;">
            <img src="${image}" 
                 alt="Image galerie"
                 style="width: 100%; max-height: 500px; object-fit: cover; display: block;"
                 onerror="this.src='https://picsum.photos/800/500?random=${Math.random()}'">
        </div>
    `;
}

// Layout pour 2 images
function createTwoImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px; height: 300px;">
            ${images.map((img, index) => `
                <div onclick="openImageLightbox(${index})" 
                     style="cursor: pointer; overflow: hidden; transition: opacity 0.3s ease;">
                    <img src="${img}" 
                         alt="Image ${index + 1}"
                         style="width: 100%; height: 100%; object-fit: cover;"
                         onerror="this.src='https://picsum.photos/400/300?random=${Math.random()}'">
                </div>
            `).join('')}
        </div>
    `;
}

// Layout pour 3 images
function createThreeImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px;">
            <div onclick="openImageLightbox(0)" 
                 style="grid-column: 1; grid-row: 1 / span 2; cursor: pointer; overflow: hidden;">
                <img src="${images[0]}" 
                     alt="Image 1"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/400/400?random=${Math.random()}'">
            </div>
            <div onclick="openImageLightbox(1)" 
                 style="grid-column: 2; grid-row: 1; cursor: pointer; overflow: hidden;">
                <img src="${images[1]}" 
                     alt="Image 2"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
            </div>
            <div onclick="openImageLightbox(2)" 
                 style="grid-column: 2; grid-row: 2; cursor: pointer; overflow: hidden;">
                <img src="${images[2]}" 
                     alt="Image 3"
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
            </div>
        </div>
    `;
}

// Layout pour 4 images
function createFourImagesLayout(images) {
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px;">
            ${images.map((img, index) => `
                <div onclick="openImageLightbox(${index})" 
                     style="cursor: pointer; overflow: hidden; transition: opacity 0.3s ease;">
                    <img src="${img}" 
                         alt="Image ${index + 1}"
                         style="width: 100%; height: 100%; object-fit: cover;"
                         onerror="this.src='https://picsum.photos/200/200?random=${Math.random()}'">
                </div>
            `).join('')}
        </div>
    `;
}

// Layout pour 5+ images (CORRIG√â pour afficher correctement le compteur)
function createMultipleImagesLayout(images) {
    const displayedImages = images.slice(0, 5); // Montrer max 5 images dans la grille
    const remainingCount = images.length - 5;
    
    console.log('üî¢ Images affich√©es:', displayedImages.length, 'Restantes:', remainingCount);
    
    return `
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 2px; height: 400px; position: relative;">
            ${displayedImages.map((img, index) => {
                let gridStyle = '';
                
                // Layout pour 5+ images (2x3 grid)
                if (index === 0) {
                    gridStyle = 'grid-column: 1 / span 2; grid-row: 1 / span 2;';
                } else if (index === 1) {
                    gridStyle = 'grid-column: 3; grid-row: 1;';
                } else if (index === 2) {
                    gridStyle = 'grid-column: 3; grid-row: 2;';
                } else if (index === 3) {
                    gridStyle = 'grid-column: 1; grid-row: 3;';
                } else if (index === 4) {
                    gridStyle = 'grid-column: 2 / span 2; grid-row: 3; position: relative;';
                }
                
                return `
                    <div onclick="openImageLightbox(${index})" 
                         style="${gridStyle} cursor: pointer; overflow: hidden; position: relative; transition: opacity 0.3s ease;">
                        <img src="${img}" 
                             alt="Image ${index + 1}"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onerror="this.src='https://picsum.photos/300/300?random=${Math.random()}'">
                        ${index === 4 && remainingCount > 0 ? `
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem; font-weight: 700; cursor: pointer;">
                                +${remainingCount}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

// Swipe sur mobile
let touchStartX = 0;
let touchEndX = 0;

document.addEventListener('touchstart', function(e) {
    const lightbox = document.getElementById('galleryLightbox');
    if (!lightbox) return;
    
    touchStartX = e.changedTouches[0].screenX;
});

document.addEventListener('touchend', function(e) {
    const lightbox = document.getElementById('galleryLightbox');
    if (!lightbox) return;
    
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
});

function handleSwipe() {
    const swipeThreshold = 50;
    const diff = touchStartX - touchEndX;
    
    if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
            lightboxNextImage(); // Swipe gauche = image suivante
        } else {
            lightboxPrevImage(); // Swipe droite = image pr√©c√©dente
        }
    }
}

</script>
</body>
</html>